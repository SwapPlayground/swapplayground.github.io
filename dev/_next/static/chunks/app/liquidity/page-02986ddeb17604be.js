(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{94349:function(e,t,o){Promise.resolve().then(o.bind(o,48855))},48855:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return LiquidityPage}});var s,a,l=o(37151),n=o(87707),i=o(26881),r=o(19605),c=o(47934),d=o(6533),m=o(64751),u=o(96111),p=o(28076),x=o(90409),h=o(91608);let g=r.forwardRef((e,t)=>{let{className:o,orientation:s="horizontal",decorative:a=!0,...n}=e;return(0,l.jsx)(x.f,{ref:t,decorative:a,orientation:s,className:(0,h.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",o),...n})});g.displayName=x.f.displayName;var f=o(69057),k=o(48553),j=o(42799),N=o(62693),y=o(23037);let w=N.fC,v=N.xz,b=N.h_;N.x8;let S=r.forwardRef((e,t)=>{let{className:o,...s}=e;return(0,l.jsx)(N.aV,{ref:t,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...s})});S.displayName=N.aV.displayName;let T=r.forwardRef((e,t)=>{let{className:o,children:s,...a}=e;return(0,l.jsxs)(b,{children:[(0,l.jsx)(S,{}),(0,l.jsxs)(N.VY,{ref:t,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...a,children:[s,(0,l.jsxs)(N.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(y.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});T.displayName=N.VY.displayName;let DialogHeader=e=>{let{className:t,...o}=e;return(0,l.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...o})};DialogHeader.displayName="DialogHeader";let DialogFooter=e=>{let{className:t,...o}=e;return(0,l.jsx)("div",{className:(0,h.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...o})};DialogFooter.displayName="DialogFooter";let F=r.forwardRef((e,t)=>{let{className:o,...s}=e;return(0,l.jsx)(N.Dx,{ref:t,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",o),...s})});F.displayName=N.Dx.displayName;let P=r.forwardRef((e,t)=>{let{className:o,...s}=e;return(0,l.jsx)(N.dk,{ref:t,className:(0,h.cn)("text-sm text-muted-foreground",o),...s})});P.displayName=N.dk.displayName;var C=o(10009),_=o(54701),D=o(5294),R=o(67963),E=o(70638),A=o(36921),M=o(9678),q=o(67919),L=o(10649),I=o(16303);function CreatePositionDialog(e){let{pool:t,refetchPositions:o}=e,{toast:s}=(0,j.pm)(),{sendTransaction:a}=(0,_.p)(),{writeContract:m}=(0,D.S)(),x=(0,c.m)(),[h,g]=(0,r.useState)(0),[f,N]=(0,r.useState)(0),[y,b]=(0,r.useState)("0"),[S,U]=(0,r.useState)(!1),[O,z]=(0,r.useState)("0"),[B,X]=(0,r.useState)(!1),[H,V]=(0,r.useState)(void 0),[Z,K]=(0,r.useState)(""),[G,Q]=(0,r.useState)(!1),[W,Y]=(0,r.useState)(""),J=(0,d.u)({address:t.pool.token0.address,abi:k.j,functionName:"allowance",args:[x.address,L._.nfpmAddress]}),$=(0,d.u)({address:t.pool.token1.address,abi:k.j,functionName:"allowance",args:[x.address,L._.nfpmAddress]}),onKeyDownTick=e=>{console.log(e.code),"ArrowUp"!=e.code&&"ArrowDown"!=e.code&&e.preventDefault()},ee=[1,1],et=[1,1];(0,r.useEffect)(()=>{if(t.pool&&(0!=h||0!=f)){if(!H){let e=new R.Position({pool:t.pool,tickLower:h,tickUpper:f,liquidity:"0"});V(e)}if("amountToken0"==Z){let e=R.Position.fromAmount0({pool:t.pool,tickLower:h,tickUpper:f,useFullPrecision:!0,amount0:(0,E.v)(y,t.pool.token0.decimals).toString()});V(e),z(e.amount1.toExact())}if("amountToken1"==Z){let e=R.Position.fromAmount1({pool:t.pool,tickLower:h,tickUpper:f,amount1:(0,E.v)(O,t.pool.token1.decimals).toString()});V(e),b(e.amount0.toExact())}if("tick"==Z){let e=new R.Position({pool:t.pool,tickLower:h,tickUpper:f,liquidity:H.liquidity});h>t.pool.tickCurrent?X(!0):X(!1),f<t.pool.tickCurrent+1?U(!0):U(!1),V(e),b(e.amount0.toExact()),z(e.amount1.toExact())}K("")}},[t.pool,y,O,h,f,Z,H]);let eo=(0,r.useMemo)(()=>{if(0>=Number(y)&&0>=Number(O)||!J.isFetched||!$.isFetched)return!1;let e=(0,E.v)(y,t.pool.token0.decimals),o=(0,E.v)(O,t.pool.token1.decimals);return!(e>J.data)&&!(o>$.data)},[y,O,t.pool,J.data,J.isFetched,$.data,$.isFetched]);return(0,l.jsxs)(w,{children:[(0,l.jsx)(v,{asChild:!0,children:(0,l.jsx)(u.z,{className:(0,u.d)({className:"max-w-40"}),onClick:()=>{V(void 0),Y(""),U(!1),X(!1),b("0"),z("0"),g((0,R.nearestUsableTick)(t.pool.tickCurrent,t.pool.tickSpacing)-2*t.pool.tickSpacing),N((0,R.nearestUsableTick)(t.pool.tickCurrent,t.pool.tickSpacing)+2*t.pool.tickSpacing)},children:"Create position"})}),(0,l.jsxs)(T,{className:"sm:max-w-[525px]",children:[(0,l.jsxs)(DialogHeader,{children:[(0,l.jsx)(F,{children:"New Position"}),(0,l.jsxs)(P,{children:[t.pool.token0.symbol," / ",t.pool.token1.symbol," fee=",t.pool.fee/1e4,"% tickSpacing=",t.pool.tickSpacing]})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"currentTick",className:"text-left",children:"Current tick"}),(0,l.jsx)(p._,{htmlFor:"currentTick",className:"col-span-3 text-center",children:t.pool.tickCurrent})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"fromTick",className:"text-left",children:"From tick"}),(0,l.jsx)(C.I,{id:"fromTick",type:"number",step:t.pool.tickSpacing,onChange:e=>{let o=Number(e.currentTarget.value);if(o>=f||o<(0,R.nearestUsableTick)(R.TickMath.MIN_TICK,t.pool.tickSpacing)){e.preventDefault(),e.target.value=h.toString();return}K("tick"),g(o)},onKeyDown:onKeyDownTick,defaultValue:h,className:"col-span-1"}),(0,l.jsxs)(p._,{htmlFor:"fromTick",className:"text-left",children:[t.pool.token0.symbol," / ",t.pool.token1.symbol]}),(0,l.jsx)(p._,{htmlFor:"fromTick",className:"text-left",children:(0,R.tickToPrice)(t.pool.token0,t.pool.token1,h).toFixed()})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"toTick",className:"text-left",children:"To tick"}),(0,l.jsx)(C.I,{id:"toTick",type:"number",step:t.pool.tickSpacing,onChange:e=>{let o=Number(e.currentTarget.value);if(o<=h||o>(0,R.nearestUsableTick)(R.TickMath.MAX_TICK,t.pool.tickSpacing)){e.preventDefault(),e.target.value=f.toString();return}K("tick"),N(o)},onKeyDown:onKeyDownTick,defaultValue:f,className:"col-span-1"}),(0,l.jsxs)(p._,{htmlFor:"toTick",className:"text-left",children:[t.pool.token0.symbol," / ",t.pool.token1.symbol]}),(0,l.jsx)(p._,{htmlFor:"toTick",className:"text-left",children:(0,R.tickToPrice)(t.pool.token0,t.pool.token1,f).toFixed()})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token0Amount",className:"text-left",children:[t.pool.token0.symbol," amount"]}),(0,l.jsx)(C.I,{inputMode:"numeric",required:!0,id:"token0Amount",value:y,disabled:S,onKeyDown:e=>{var t,o;"Space"==e.code&&e.preventDefault(),ee[0]=null!==(t=e.currentTarget.selectionStart)&&void 0!==t?t:0,ee[1]=null!==(o=e.currentTarget.selectionEnd)&&void 0!==o?o:0},onChange:e=>{let t=Number(e.currentTarget.value);if(console.log("nVal: "+t),isNaN(t)||t<0||0==e.currentTarget.value.length){e.preventDefault(),e.target.value=y,e.target.selectionStart=ee[0],e.target.selectionEnd=ee[1];return}K("amountToken0"),b(e.target.value)}}),(0,l.jsxs)(p._,{htmlFor:"token1Amount",className:"text-left",children:[t.pool.token1.symbol," amount"]}),(0,l.jsx)(C.I,{inputMode:"numeric",required:!0,id:"token1Amount",value:O,disabled:B,onKeyDown:e=>{var t,o;"Space"==e.code&&e.preventDefault(),et[0]=null!==(t=e.currentTarget.selectionStart)&&void 0!==t?t:0,et[1]=null!==(o=e.currentTarget.selectionEnd)&&void 0!==o?o:0},onChange:e=>{let t=Number(e.currentTarget.value);if(console.log("nVal: "+t),isNaN(t)||t<0||0==e.currentTarget.value.length){e.preventDefault(),e.target.value=O,e.target.selectionStart=et[0],e.target.selectionEnd=et[1];return}K("amountToken1"),z(e.target.value)}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token0Allowance",className:"text-left",children:[t.pool.token0.symbol," allowance"]}),(0,l.jsx)(p._,{htmlFor:"token0Allowance",className:"text-left",children:J.isFetched?(0,A.b)(J.data,t.pool.token0.decimals):"Loading..."}),(0,l.jsxs)(u.z,{className:(0,u.d)({className:"max-w-60 col-span-2"}),onClick:()=>{Q(!0),m({address:t.pool.token0.address,abi:k.j,functionName:"approve",args:[L._.nfpmAddress,(0,E.v)(y,t.pool.token0.decimals)]},{onSuccess:(e,t,o)=>{s({variant:"default",title:"Submitted allowance transaction",description:e})},onError:(e,t,o)=>{Q(!1),s({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("AllowanceError: "+e)},onSettled:(e,t,o,s)=>{Q(!1),J.refetch()}})},children:[G?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),G?"Please wait...":"Increase "+t.pool.token0.symbol+" allowance"]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token1Allowance",className:"text-left",children:[t.pool.token1.symbol," allowance"]}),(0,l.jsx)(p._,{htmlFor:"token1Allowance",className:"text-left",children:$.isFetched?(0,A.b)($.data,t.pool.token1.decimals):"Loading..."}),(0,l.jsxs)(u.z,{className:(0,u.d)({className:"max-w-60 col-span-2"}),onClick:()=>{Q(!0),m({address:t.pool.token1.address,abi:k.j,functionName:"approve",args:[L._.nfpmAddress,(0,E.v)(O,t.pool.token1.decimals)]},{onSuccess:(e,t,o)=>{s({variant:"default",title:"Submitted allowance transaction",description:e})},onError:(e,t,o)=>{Q(!1),s({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("AllowanceError: "+e)},onSettled:(e,t,o,s)=>{Q(!1),$.refetch()}})},children:[G?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),G?"Please wait...":"Increase "+t.pool.token1.symbol+" allowance"]})]}),""!=W&&(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"currentTick",className:"text-left",children:"Transaction"}),(0,l.jsx)(p._,{htmlFor:"currentTick",className:"col-span-3 text-center",children:(0,l.jsx)(I.Z,{hash:W,children:W})})]})]}),(0,l.jsx)(DialogFooter,{children:(0,l.jsxs)(u.z,{disabled:!eo,onClick:()=>{Q(!0);let e=R.Position.fromAmount0({pool:t.pool,tickLower:h,tickUpper:f,useFullPrecision:!0,amount0:(0,E.v)(y,t.pool.token0.decimals).toString()}),l={recipient:x.address,deadline:Math.floor(Date.now()/1e3)+1200,slippageTolerance:new i.Percent(50,1e4)},{calldata:r,value:c}=R.NonfungiblePositionManager.addCallParameters(e,l);a({to:n.Q.address,data:r,value:BigInt(c),account:x.address},{onSuccess:(e,t,o)=>{s({variant:"default",title:"Submitted create position transaction",description:e}),Y(e)},onError:(e,t,o)=>{Q(!1),s({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("CreatePositionError: "+e)},onSettled:(e,t,s,a)=>{Q(!1),o()}})},children:[G?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),G?"Please wait...":"Create position"]})})]})]})}var U=o(38682),O=o.n(U),z=o(61900).Buffer;function PositionURI(e){let{id:t}=e,[o,s]=(0,r.useState)(!1),a=(0,d.u)({...n.Q,functionName:"tokenURI",args:[t],query:{enabled:o}}),i=(0,r.useMemo)(()=>{if(!a.isFetched)return;let e=a.data,t="data:application/json;base64,";if(!e.startsWith(t))return;let o=z.from(e.substring(t.length),"base64").toString(),s=JSON.parse(o);return s},[a]);return(0,l.jsxs)(w,{children:[(0,l.jsx)(v,{asChild:!0,children:(0,l.jsx)("a",{onClick:()=>s(!0),children:t})}),(0,l.jsxs)(T,{className:"sm:max-w-[325px]",children:[(0,l.jsx)(DialogHeader,{children:(0,l.jsx)(F,{children:i?i.name:"Position URI"})}),(0,l.jsx)("div",{className:"grid gap-4 py-4",children:i&&(0,l.jsx)(O(),{src:i.image,about:i.description,alt:"Loading...",width:300,height:450})})]})]})}var B=o(79007),X=o.n(B);function UpdatePositionDialog(e){let{pool:t,position:o,refetchPositions:s}=e,{toast:a}=(0,j.pm)(),{sendTransaction:m}=(0,_.p)(),{writeContract:x}=(0,D.S)(),h=(0,c.m)(),[g,f]=(0,r.useState)("0"),[N,y]=(0,r.useState)(!1),[b,S]=(0,r.useState)("0"),[U,O]=(0,r.useState)(!1),[z,B]=(0,r.useState)(void 0),[H,V]=(0,r.useState)(void 0),[Z,K]=(0,r.useState)(""),[G,Q]=(0,r.useState)(void 0),[W,Y]=(0,r.useState)(""),[J,$]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(""),[eo,es]=(0,r.useState)("None"),ea=(0,d.u)({address:t.pool.token0.address,abi:k.j,functionName:"allowance",args:[h.address,L._.nfpmAddress]}),el=(0,d.u)({address:t.pool.token1.address,abi:k.j,functionName:"allowance",args:[h.address,L._.nfpmAddress]}),en=[1,1],ei=[1,1];(0,r.useEffect)(()=>{let e;if(t.pool){if(!G){let s=new R.Position({pool:t.pool,tickLower:o.tickLower,tickUpper:o.tickUpper,liquidity:o.liquidity});Q(s),B(s),V(new R.Position({pool:t.pool,tickLower:o.tickLower,tickUpper:o.tickUpper,liquidity:"0"})),f(s.amount0.toExact()),S(s.amount1.toExact()),X().notEqual(s.liquidity,X().BigInt("0"))&&(y("0"==s.amount0.toExact()),O("0"==s.amount1.toExact())),e=s}if("amountToken0"==W){let s=R.Position.fromAmount0({pool:t.pool,tickLower:o.tickLower,tickUpper:o.tickUpper,useFullPrecision:!0,amount0:(0,E.v)(g,t.pool.token0.decimals).toString()});Q(s),S(s.amount1.toExact()),e=s}if("amountToken1"==W){let s=R.Position.fromAmount1({pool:t.pool,tickLower:o.tickLower,tickUpper:o.tickUpper,amount1:(0,E.v)(b,t.pool.token1.decimals).toString()});Q(s),f(s.amount0.toExact()),e=s}if(e){let s=X().BigInt(o.liquidity),a=X().BigInt("0"),l=X().subtract(s,e.liquidity),n=X().greaterThanOrEqual(l,X().BigInt("0"))?l:X().unaryMinus(l);X().greaterThan(l,a)?K("-"):X().lessThan(l,a)?K("+"):K("");let i=new R.Position({pool:t.pool,tickLower:o.tickLower,tickUpper:o.tickUpper,liquidity:n});V(i),X().greaterThan(e.liquidity,s)?es("Increase liquidity"):X().lessThan(e.liquidity,s)?X().equal(e.liquidity,X().BigInt("0"))?es("Close position"):es("Decrease liquidity"):es("None")}Y("")}},[t.pool,g,b,o,W,G]),console.log("positionAction: "+eo);let er=(0,r.useMemo)(()=>{if(["Close position","Decrease liquidity",""].includes(eo))return!0;if(!H||!ea.isFetched||!el.isFetched)return!1;let e=(0,E.v)(H.amount0.toExact(),t.pool.token0.decimals),o=(0,E.v)(H.amount1.toExact(),t.pool.token1.decimals);return!(e>el.data)&&!(o>el.data)},[H,t.pool,ea,el,eo]);return(0,l.jsxs)(w,{children:[(0,l.jsx)(v,{asChild:!0,children:(0,l.jsx)(u.z,{className:(0,u.d)({className:"max-w-40"}),onClick:()=>{Q(void 0),et("")},children:"Update position"})}),(0,l.jsxs)(T,{className:"sm:max-w-[525px]",children:[(0,l.jsxs)(DialogHeader,{children:[(0,l.jsx)(F,{children:"Update Position"}),(0,l.jsxs)(P,{children:["#",o.id,": ",t.pool.token0.symbol," / ",t.pool.token1.symbol," fee=",t.pool.fee/1e4,"% tickSpacing=",t.pool.tickSpacing]})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"currentTick",className:"text-left",children:"Current tick"}),(0,l.jsx)(p._,{htmlFor:"currentTick",className:"col-span-3 text-center font-mono",children:t.pool.tickCurrent})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"fromTick",className:"text-left",children:"From tick"}),(0,l.jsx)(p._,{htmlFor:"fromTick",className:"text-right font-mono",children:o.tickLower}),(0,l.jsxs)(p._,{htmlFor:"fromTick",className:"text-left",children:[t.pool.token0.symbol," / ",t.pool.token1.symbol]}),(0,l.jsx)(p._,{htmlFor:"fromTick",className:"text-right font-mono",children:(0,R.tickToPrice)(t.pool.token0,t.pool.token1,o.tickLower).toFixed()})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"toTick",className:"text-left",children:"To tick"}),(0,l.jsx)(p._,{htmlFor:"toTick",className:"text-right font-mono",children:o.tickUpper}),(0,l.jsxs)(p._,{htmlFor:"toTick",className:"text-left",children:[t.pool.token0.symbol," / ",t.pool.token1.symbol]}),(0,l.jsx)(p._,{htmlFor:"toTick",className:"text-right font-mono",children:(0,R.tickToPrice)(t.pool.token0,t.pool.token1,o.tickUpper).toFixed()})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"token0Amount",className:"text-left",children:"Current liquidity"}),(0,l.jsx)(p._,{htmlFor:"toTick",className:"col-span-3 text-center font-mono",children:o.liquidity})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token0PositionBalance",className:"text-left",children:["Current position ",t.pool.token0.symbol," balance"]}),(0,l.jsx)(p._,{htmlFor:"token0PositionBalance",className:"text-right font-mono",children:z?z.amount0.toExact():"Calculating..."}),(0,l.jsxs)(p._,{htmlFor:"token1PositionBalance",className:"text-left",children:["Current position ",t.pool.token1.symbol," balance"]}),(0,l.jsx)(p._,{htmlFor:"token1PositionBalance",className:"text-right font-mono",children:z?z.amount1.toExact():"Calculating..."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token0Amount",className:"text-left",children:["Target ",t.pool.token0.symbol," amount"]}),(0,l.jsx)(C.I,{inputMode:"numeric",required:!0,id:"token0Amount",value:g,disabled:N,onKeyDown:e=>{var t,o;"Space"==e.code&&e.preventDefault(),en[0]=null!==(t=e.currentTarget.selectionStart)&&void 0!==t?t:0,en[1]=null!==(o=e.currentTarget.selectionEnd)&&void 0!==o?o:0},onChange:e=>{let t=Number(e.currentTarget.value);if(console.log("nVal: "+t),isNaN(t)||t<0||0==e.currentTarget.value.length){e.preventDefault(),e.target.value=g,e.target.selectionStart=en[0],e.target.selectionEnd=en[1];return}Y("amountToken0"),f(e.target.value)}}),(0,l.jsxs)(p._,{htmlFor:"token1Amount",className:"text-left",children:["Target ",t.pool.token1.symbol," amount"]}),(0,l.jsx)(C.I,{inputMode:"numeric",required:!0,id:"token1Amount",value:b,disabled:U,onKeyDown:e=>{var t,o;"Space"==e.code&&e.preventDefault(),ei[0]=null!==(t=e.currentTarget.selectionStart)&&void 0!==t?t:0,ei[1]=null!==(o=e.currentTarget.selectionEnd)&&void 0!==o?o:0},onChange:e=>{let t=Number(e.currentTarget.value);if(console.log("nVal: "+t),isNaN(t)||t<0||0==e.currentTarget.value.length){e.preventDefault(),e.target.value=b,e.target.selectionStart=ei[0],e.target.selectionEnd=ei[1];return}Y("amountToken1"),S(e.target.value)}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"token0Amount",className:"text-left",children:"Target liquidity"}),(0,l.jsx)(p._,{htmlFor:"toTick",className:"col-span-3 text-center font-mono",children:G?G.liquidity.toString():"0"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token0PositionBalance",className:"text-left",children:["Adjustment ",t.pool.token0.symbol," amount"]}),(0,l.jsxs)(p._,{htmlFor:"token0PositionBalance",className:"text-right font-mono",children:[Z,H?H.amount0.toExact():"Calculating..."]}),(0,l.jsxs)(p._,{htmlFor:"token1PositionBalance",className:"text-left",children:["Adjustment ",t.pool.token1.symbol," amount"]}),(0,l.jsxs)(p._,{htmlFor:"token1PositionBalance",className:"text-right font-mono",children:[Z,H?H.amount1.toExact():"Calculating..."]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"token0Amount",className:"text-left",children:"Adjustment liquidity"}),(0,l.jsxs)(p._,{htmlFor:"toTick",className:"col-span-3 text-center font-mono",children:[Z,H?H.liquidity.toString():"0"]})]}),"+"==Z&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token0Allowance",className:"text-left",children:[t.pool.token0.symbol," allowance"]}),(0,l.jsx)(p._,{htmlFor:"token0Allowance",className:"text-right font-mono",children:ea.isFetched?(0,A.b)(ea.data,t.pool.token0.decimals):"Loading..."}),(0,l.jsxs)(u.z,{className:(0,u.d)({className:"max-w-60 col-span-2"}),onClick:()=>{$(!0),x({address:t.pool.token0.address,abi:k.j,functionName:"approve",args:[L._.nfpmAddress,(0,E.v)(g,t.pool.token0.decimals)]},{onSuccess:(e,t,o)=>{a({variant:"default",title:"Submitted allowance transaction",description:e})},onError:(e,t,o)=>{$(!1),a({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("AllowanceError: "+e)},onSettled:(e,t,o,s)=>{$(!1),ea.refetch()}})},children:[J?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),J?"Please wait...":"Increase "+t.pool.token0.symbol+" allowance"]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsxs)(p._,{htmlFor:"token1Allowance",className:"text-left",children:[t.pool.token1.symbol," allowance"]}),(0,l.jsx)(p._,{htmlFor:"token1Allowance",className:"text-right font-mono",children:el.isFetched?(0,A.b)(el.data,t.pool.token1.decimals):"Loading..."}),(0,l.jsxs)(u.z,{className:(0,u.d)({className:"max-w-60 col-span-2"}),onClick:()=>{$(!0),x({address:t.pool.token1.address,abi:k.j,functionName:"approve",args:[L._.nfpmAddress,(0,E.v)(b,t.pool.token1.decimals)]},{onSuccess:(e,t,o)=>{a({variant:"default",title:"Submitted allowance transaction",description:e})},onError:(e,t,o)=>{$(!1),a({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("AllowanceError: "+e)},onSettled:(e,t,o,s)=>{$(!1),el.refetch()}})},children:[J?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),J?"Please wait...":"Increase "+t.pool.token1.symbol+" allowance"]})]})]}),""!=ee&&(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"currentTick",className:"text-left",children:"Transaction"}),(0,l.jsx)(p._,{htmlFor:"currentTick",className:"col-span-3 text-center",children:(0,l.jsx)(I.Z,{hash:ee,children:ee})})]})]}),(0,l.jsxs)(DialogFooter,{children:["Increase liquidity"==eo&&(0,l.jsxs)(u.z,{disabled:!er,onClick:()=>{$(!0);let e={tokenId:o.id,deadline:Math.floor(Date.now()/1e3)+1200,slippageTolerance:new i.Percent(50,1e4)},{calldata:t,value:l}=R.NonfungiblePositionManager.addCallParameters(H,e);m({to:n.Q.address,data:t,value:BigInt(l),account:h.address},{onSuccess:(e,t,o)=>{a({variant:"default",title:"Submitted "+eo.toLocaleLowerCase()+" transaction",description:e}),et(e)},onError:(e,t,o)=>{$(!1),a({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("IncreaseLiquidityError: "+e)},onSettled:(e,t,o,a)=>{$(!1),s()}})},children:[J?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),J?"Please wait...":eo.toString()]}),("Decrease liquidity"==eo||"Close position"==eo)&&(0,l.jsxs)(u.z,{disabled:!er,onClick:()=>{$(!0);let e=new R.Position({pool:t.pool,tickLower:o.tickLower,tickUpper:o.tickUpper,liquidity:o.liquidity}),l={tokenId:o.id,deadline:Math.floor(Date.now()/1e3)+1200,slippageTolerance:new i.Percent(50,1e4),liquidityPercentage:new i.Percent(X().subtract(e.liquidity,G.liquidity),e.liquidity),collectOptions:{expectedCurrencyOwed0:i.CurrencyAmount.fromRawAmount(t.pool.token0,"0"),expectedCurrencyOwed1:i.CurrencyAmount.fromRawAmount(t.pool.token1,"0"),recipient:h.address}},{calldata:r,value:c}=R.NonfungiblePositionManager.removeCallParameters(e,l);m({to:n.Q.address,data:r,value:BigInt(c),account:h.address},{onSuccess:(e,t,o)=>{a({variant:"default",title:"Submitted "+eo.toLocaleLowerCase()+" transaction",description:e}),et(e)},onError:(e,t,o)=>{$(!1),a({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("RemoveLiquidityError: "+e)},onSettled:(e,t,o,a)=>{$(!1),s()}})},children:[J?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),J?"Please wait...":eo]})]})]})]})}(s=a||(a={})).None="None",s.IncreaseLiquidity="Increase liquidity",s.DecreaseLiquidity="Decrease liquidity",s.ClosePosition="Close position";var H=o(9717);function PoolDetails(e){let{pool:t,positions:o,refetchPositions:s}=e,[a,n]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&t.pool&&a.id&&(t.pool.fee!=a.fee&&n({}),t.pool.token0.address!=a.token0&&n({}),t.pool.token1.address!=a.token1&&n({}))},[t,a]);let i=[];if(o&&o.length>0){let e=0;for(let s of o)s.fee==t.pool.fee&&s.token0==t.pool.token0.address&&s.token1==t.pool.token1.address&&i.push((0,l.jsxs)(f.SC,{className:s.id==a.id?"bg-gray-300":"",onClick:e=>{n(s)},children:[(0,l.jsx)(f.pj,{className:"font-medium",children:(0,l.jsx)(PositionURI,{id:s.id})}),(0,l.jsx)(f.pj,{className:"text-right",children:s.tickLower.toString()}),(0,l.jsx)(f.pj,{className:"text-right",children:s.tickUpper.toString()}),(0,l.jsx)(f.pj,{className:"text-right",children:s.liquidity.toString()})]},"positionRow_"+e++))}return(0,l.jsxs)(m.Zb,{className:"flex:50% w-5/12 min-w-[410px]",children:[(0,l.jsx)(m.Ol,{children:(0,l.jsx)(m.ll,{children:"Pool Details"})}),(0,l.jsx)(m.aY,{children:(0,l.jsx)("form",{children:(0,l.jsx)("div",{className:"space-x-5",children:(0,l.jsx)("div",{className:"flex-1 space-y-2",children:(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,l.jsx)(p._,{htmlFor:"address",children:"Pool address"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,l.jsx)(H.default,{address:t.address,children:t.address})}),(0,l.jsx)(p._,{htmlFor:"fee",children:"Fee"}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground",children:[t.pool.fee/1e4,"%"]}),(0,l.jsx)(p._,{htmlFor:"tickSpacing",children:"Current tick"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:t.pool.tickCurrent}),(0,l.jsx)(p._,{htmlFor:"tickSpacing",children:"Tick spacing"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:t.pool.tickSpacing}),(0,l.jsx)(p._,{htmlFor:"tickSpacing",children:"Positions"}),i.length>0?(0,l.jsxs)(f.iA,{children:[(0,l.jsx)(f.xD,{children:(0,l.jsxs)(f.SC,{children:[(0,l.jsx)(f.ss,{className:"w-[40px] font-bold",children:"ID"}),(0,l.jsx)(f.ss,{className:"w-[40px] text-right font-bold",children:"Tick Low"}),(0,l.jsx)(f.ss,{className:"w-[40px] text-right font-bold",children:"Tick High"}),(0,l.jsx)(f.ss,{className:"text-right font-bold",children:"Liquidity"})]})}),(0,l.jsx)(f.RM,{children:i})]}):(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"No positions"})]})})})})}),(0,l.jsx)(m.eW,{children:(0,l.jsx)("div",{className:"columns-2",children:(0,l.jsxs)("div",{className:"space-x-0.5",children:[(0,l.jsx)(CreatePositionDialog,{pool:t,refetchPositions:s}),(0,l.jsx)(g,{orientation:"horizontal"}),a.id?(0,l.jsx)(UpdatePositionDialog,{pool:t,position:a,refetchPositions:s}):(0,l.jsx)(u.z,{className:(0,u.d)({className:"max-w-40"}),disabled:!0,children:"Update position"})]})})})]})}var V=o(3306),Z=o(30711),K=o(12741),G=o(74270);o(24534);var Q=o(56118);let W=[{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getEthBalance",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct UniswapInterfaceMulticall.Call[]",name:"calls",type:"tuple[]"}],name:"multicall",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"},{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"uint256",name:"gasUsed",type:"uint256"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct UniswapInterfaceMulticall.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}];let multiCall_MultiCall=class multiCall_MultiCall{encodeCallData(e,t,o){return{target:e.address,callData:e.interface.encodeFunctionData(t,o),gasLimit:this.gasLimitPerCall}}decodeCallResult(e,t,o){return e.interface.decodeFunctionResult(t,o)}async callMethodMultipleTimes(e,t,o){try{let s=o.map(o=>this.encodeCallData(e,t,o)),a=await this.multiCallContract.callStatic.multicall(s);return a.returnData.map(o=>this.decodeCallResult(e,t,o.returnData))}catch(e){throw console.error("Error in callMethodMultipleTimes for method ".concat(t," with params ").concat(JSON.stringify(o),":"),e),e}}constructor(e,t=1e6){this.multiCallContract=new Q.CH(L._.multiCallAddress,W,e),this.gasLimitPerCall=t}};let Y=[R.FeeAmount.HIGH,R.FeeAmount.MEDIUM,R.FeeAmount.LOW,R.FeeAmount.LOWEST],J=new i.Token(i.ChainId.SEPOLIA,L._.sptAddress,18,"SPT","Swap Playground Token"),getPoolsForTokensMultiCall=async(e,t,o)=>{let s=new Map,a=L._.uniswapV3FactoryAddress;if(void 0===a)return s;let l=new Q.CH(a,K.Mt,e),n=new Q.CH("0x0000000000000000000000000000000000000000",G.Mt,e),i=new multiCall_MultiCall(e),r=[];for(let e of Y)r.push([t.address,o.address,e]);let c=await i.callMethodMultipleTimes(l,"getPool",r),d=[];for(let e=0;e<c.length;e++){let t=c[e].toString();"0x0000000000000000000000000000000000000000"!=t&&(d.push({target:t,callData:n.interface.encodeFunctionData("liquidity"),gasLimit:1e6}),d.push({target:t,callData:n.interface.encodeFunctionData("slot0"),gasLimit:1e6}))}let m=await i.multiCallContract.callStatic.multicall(d),u=0;for(let e=0;e<Y.length;e++){let a=Y[e],l=c[e].toString();if("0x0000000000000000000000000000000000000000"==l){s.set(a,{address:l,pool:void 0});continue}let i=n.interface.decodeFunctionResult("liquidity",m.returnData[2*u].returnData),r=n.interface.decodeFunctionResult("slot0",m.returnData[2*u+1].returnData),d=new R.Pool(t,o,a,r.sqrtPriceX96.toString(),i.toString(),r.tick);s.set(a,{address:l,pool:d}),u++}return s},getMediumSPTRateForTokens=async(e,t,o)=>{let s=L._.uniswapV3FactoryAddress;if(void 0===s)throw Error("Invalid factory address");let a=new Q.CH(s,K.Mt,e);if("SPT"==t.symbol||"SPT"==o.symbol){let s=await getMediumFeePoolForTokens(e,a,t,o);return s.token0Price.toFixed(18)}let l=await getMediumFeePoolForTokens(e,a,t,J),n=await getMediumFeePoolForTokens(e,a,o,J),i=l.token0.address==t.address?l.token0Price:l.token1Price,r=n.token0.address==o.address?n.token1Price:n.token0Price,c=i.multiply(r),d=new R.Pool(t,o,R.FeeAmount.MEDIUM,(0,R.encodeSqrtRatioX96)("1","1"),"0",0),m=d.token0.address==t.address?c.toFixed(18):c.invert().toFixed(18);return m},getMediumFeePoolForTokens=async(e,t,o,s)=>{let a=await t.getPool(o.address,s.address,R.FeeAmount.MEDIUM);if("0x0000000000000000000000000000000000000000"==a)throw Error("Unable to find Medium FEE Pool for ".concat(o.symbol," and ").concat(s.symbol));let l=new Q.CH(a,G.Mt,e),n=await l.slot0(),i=new R.Pool(o,s,R.FeeAmount.MEDIUM,n.sqrtPriceX96.toString(),"0",n.tick);return i};var $=o(99921),ee=o(47220),et=o(20803);let eo=r.forwardRef((e,t)=>{let{className:o,...s}=e;return(0,l.jsx)(ee.fC,{ref:t,className:(0,h.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",o),...s,children:(0,l.jsx)(ee.z$,{className:(0,h.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(et.Z,{className:"h-4 w-4"})})})});function CreatePoolDialog(e){let{dummyPool:t,fee:o,defaultRate:s,refetchPools:a}=e,{toast:n}=(0,j.pm)(),{sendTransaction:i}=(0,_.p)(),d=(0,c.m)(),[m,x]=(0,r.useState)(!1),[h,g]=(0,r.useState)("0"),[f,k]=(0,r.useState)(!1),[N,y]=(0,r.useState)(""),[b,S]=(0,r.useState)(!1),D=[1,1];return(0,l.jsxs)(w,{children:[(0,l.jsx)(v,{asChild:!0,children:(0,l.jsxs)(u.z,{className:(0,u.d)({className:"min-w-60"}),onClick:()=>{S(!1),x(!1),y(""),g(s)},children:["Create Pool with ",Number(o)/1e4,"% fee"]})}),(0,l.jsxs)(T,{className:"sm:max-w-[525px]",children:[(0,l.jsxs)(DialogHeader,{children:[(0,l.jsx)(F,{children:"New Pool"}),t&&(0,l.jsxs)(P,{children:[t.token0.symbol," / ",t.token1.symbol," fee=",o/1e4,"%"]})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"defaultRate",className:"text-left",children:"Default rate"}),(0,l.jsx)(p._,{htmlFor:"defaultRate",className:"col-span-3 text-center",children:s})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(eo,{id:"overrideRateTick",checked:m,onCheckedChange:e=>x(e)}),(0,l.jsx)(p._,{htmlFor:"overrideRateTick",className:"text-left",children:"Override the default rate"})]}),m&&(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"overrideRate",className:"text-left",children:"Override rate"}),(0,l.jsx)(C.I,{className:"col-span-3",inputMode:"numeric",id:"overrideRate",value:h,disabled:!m,onKeyDown:e=>{var t,o;"Space"==e.code&&e.preventDefault(),D[0]=null!==(t=e.currentTarget.selectionStart)&&void 0!==t?t:0,D[1]=null!==(o=e.currentTarget.selectionEnd)&&void 0!==o?o:0},onChange:e=>{let t=Number(e.currentTarget.value);if(console.log("nVal: "+t),isNaN(t)||t<0||0==e.currentTarget.value.length){e.preventDefault(),e.target.value=h,e.target.selectionStart=D[0],e.target.selectionEnd=D[1];return}g(e.target.value)}})]})]}),""!=N&&(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(p._,{htmlFor:"transaction",className:"text-left",children:"Transaction"}),(0,l.jsx)(p._,{htmlFor:"transaction",className:"col-span-3 text-center",children:(0,l.jsx)(I.Z,{hash:N,children:N})})]})]}),(0,l.jsx)(DialogFooter,{children:(0,l.jsxs)(u.z,{disabled:b,onClick:()=>{k(!0);let e=m?h:s,l=(0,E.v)(e,18).toString(),r=(0,E.v)("1",18).toString(),c=(0,R.encodeSqrtRatioX96)(l,r),u=R.TickMath.getTickAtSqrtRatio(c);console.log("tickAtRatio: "+u);let p=new R.Pool(t.token0,t.token1,o,c,"0",u),x=R.NonfungiblePositionManager.createCallParameters(p);i({to:L._.nfpmAddress,data:x.calldata,account:d.address,value:BigInt(0)},{onSuccess:(e,t,o)=>{y(e),n({variant:"default",title:"Submitted pool creation transaction",description:e})},onError:(e,t,o)=>{k(!1),n({variant:"destructive",title:"ERROR",description:(0,M.X)(e.message)}),console.log("SwapError: "+e)},onSettled:(e,t,o,s)=>{k(!1),S(!0),a()}})},children:[f?(0,l.jsx)(q.Z,{className:"mr-2 w-4 animate-spin"}):(0,l.jsx)(l.Fragment,{}),f?"Please wait...":"Create Pool"]})})]})]})}function PoolsCard(e){let{tokens:t,src:o,setSrc:s,dst:a,setDst:n,pool:i,setPool:d}=e,{toast:u}=(0,j.pm)();(0,c.m)();let{sendTransaction:x}=(0,_.p)(),h=(0,Z.Z)(),[k,N]=(0,r.useState)(!1),[y,w]=(0,r.useState)("");(0,$.H)();let v=[];for(let e of t.values())v.push((0,l.jsx)(V.Ql,{value:e.address,children:e.symbol},e.address));let b=(0,r.useMemo)(()=>{if(o.address&&a.address&&o.address!=a.address)return new R.Pool(o,a,R.FeeAmount.MEDIUM,(0,R.encodeSqrtRatioX96)("1","1"),"0",0)},[o,a]),[S,T]=(0,r.useState)(0),refetchPools=()=>{T(S+1)},{loading:F,error:P,value:C}=function(e,t){let[o,s]=(0,r.useState)(!1),[a,l]=(0,r.useState)(),[n,i]=(0,r.useState)(),c=(0,r.useCallback)(()=>{s(!0),l(void 0),i(void 0),e().then(i).catch(l).finally(()=>s(!1))},t);return(0,r.useEffect)(()=>{c()},[c]),{loading:o,error:a,value:n}}(async()=>{console.log("retrieving pools...");let e=new Map;if(!o.address||!a.address||o.address==a.address)return w("1"),e;if(!h)return e;let t=await getMediumSPTRateForTokens(h,o,a);return console.log("DefaultRate="+t),w(t),await getPoolsForTokensMultiCall(h,o,a)},[o,a,S]),D=[];if(C&&C.size>0){let e=0;for(let t of Y){let o=C.get(t);o&&o.pool?D.push((0,l.jsxs)(f.SC,{className:o.address==i.address?"bg-gray-300":"",onClick:e=>{o.pool&&d(o)},children:[(0,l.jsxs)(f.pj,{className:"font-medium",children:[Number(t)/1e4,"%"]}),(0,l.jsx)(f.pj,{className:"text-right",children:o.pool.priceOf(o.pool.token0).toFixed()}),(0,l.jsx)(f.pj,{className:"text-right",children:o.pool.priceOf(o.pool.token1).toFixed()})]},"poolRow_"+e)):D.push((0,l.jsxs)(f.SC,{children:[(0,l.jsxs)(f.pj,{className:"font-medium",children:[Number(t)/1e4,"%"]}),(0,l.jsx)(f.pj,{colSpan:2,className:"text-center",children:(0,l.jsx)(CreatePoolDialog,{dummyPool:b,defaultRate:y,fee:t,refetchPools:refetchPools},t)})]},"poolRow_"+e)),e++}}return(0,r.useEffect)(()=>{P&&u({variant:"destructive",title:"ERROR",description:(0,M.X)(P.toString())})},[P,u]),(0,l.jsxs)(m.Zb,{className:"flex:50% w-5/12 min-w-[410px]",children:[(0,l.jsx)(m.Ol,{children:(0,l.jsx)(m.ll,{children:"Pools"})}),(0,l.jsx)(m.aY,{children:(0,l.jsxs)("form",{children:[(0,l.jsxs)("div",{className:"flex space-x-5",children:[(0,l.jsx)("div",{className:"flex-1 space-y-2",children:(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,l.jsx)(p._,{htmlFor:"fromToken",children:"From token"}),(0,l.jsxs)(V.Ph,{onValueChange:e=>{d({}),s(t.get(e))},children:[(0,l.jsx)(V.i4,{id:"fromToken",children:(0,l.jsx)(V.ki,{placeholder:o.symbol?o.symbol:"Please select a token"})}),(0,l.jsx)(V.Bw,{position:"popper",children:v})]})]})}),(0,l.jsx)("div",{className:"flex-1 space-y-2",children:(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,l.jsx)(p._,{htmlFor:"toToken",children:"To token"}),(0,l.jsxs)(V.Ph,{onValueChange:e=>{d({}),n(t.get(e))},children:[(0,l.jsx)(V.i4,{id:"toToken",children:(0,l.jsx)(V.ki,{placeholder:a.symbol?a.symbol:"Please select a token"})}),(0,l.jsx)(V.Bw,{position:"popper",children:v})]})]})})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)(g,{orientation:"vertical",className:"my-2"}),(0,l.jsx)("div",{className:"flex space-x-5",children:(0,l.jsx)("div",{className:"flex-1 space-y-2",children:(0,l.jsx)("div",{className:"flex flex-col space-y-2",children:b&&(0,l.jsxs)(f.iA,{children:[(0,l.jsx)(f.xD,{children:(0,l.jsxs)(f.SC,{children:[(0,l.jsx)(f.ss,{className:"w-[40px] font-bold",children:"Fee"}),(0,l.jsxs)(f.ss,{className:"text-right font-bold",children:[b.token0.symbol," / ",b.token1.symbol]}),(0,l.jsxs)(f.ss,{className:"text-right font-bold",children:[b.token1.symbol," / ",b.token0.symbol]})]})}),(0,l.jsx)(f.RM,{children:D})]})})})})]})]})}),(0,l.jsx)(m.eW,{children:(0,l.jsx)("div",{className:"columns-1",children:(0,l.jsx)("div",{className:"space-y-1"})})})]})}function LiquidityPage(){let[e,t]=(0,r.useState)({}),[o,s]=(0,r.useState)({}),[a,m]=(0,r.useState)({}),u=(0,c.m)(),p=(0,d.u)({...n.L,functionName:"getAllManagedTokens",args:[]}),x=(0,d.u)({...n.L,functionName:"getSPPositions",args:[u.address],query:{enabled:u.isConnected}}),h=(0,r.useMemo)(()=>{let e=new Map;if(p.isFetched&&p.data)for(let t of p.data)e.set(t.tokenAddress,new i.Token(i.ChainId.SEPOLIA,t.tokenAddress,t.decimals,t.symbol,t.name));if(console.log(e),e.size>3){let t=e.values();t.next(),s(t.next().value),m(t.next().value)}return e},[p.data,p.isFetched]),g=(0,r.useMemo)(()=>{console.log("retrieving positions");let e=[];if(!x.isFetched||!x.data)return e;for(let t of x.data)e.push({id:t.positionId.toString(),nonce:Number(t.nonce),token0:t.token0,token1:t.token1,fee:t.fee,tickLower:t.tickLower,tickUpper:t.tickUpper,liquidity:t.liquidity.toString(),feeGrowthInside0LastX128:t.feeGrowthInside0LastX128.toString(),feeGrowthInside1LastX128:t.feeGrowthInside1LastX128.toString(),tokensOwed0:t.tokensOwed0.toString(),tokensOwed1:t.tokensOwed1.toString()});return e},[x.isFetched,x.data]);return(0,l.jsx)("section",{className:"container grid items-center gap-6 pb-8 pt-6 md:py-10",children:(0,l.jsxs)("div",{className:"flex max-w-[980px] flex-wrap items-start gap-2",children:[(0,l.jsxs)("p",{className:"text-lg text-muted-foreground",children:["Liquidity provision is (especially in uniswap V3) is not a simple topic. Please read about ",(0,l.jsx)("a",{href:"https://docs.uniswap.org/concepts/protocol/concentrated-liquidity",target:"_blank",children:"concentrated liquidity"})," before deploying new pools/positions."]}),(0,l.jsx)("p",{className:"text-lg text-muted-foreground",children:"This page only shows positions owned by the connected account/wallet."}),(0,l.jsx)(PoolsCard,{tokens:h,src:o,setSrc:s,dst:a,setDst:m,pool:e,setPool:t}),u.isConnected?(0,l.jsx)(l.Fragment,{children:e&&e.pool&&e.pool.fee&&(0,l.jsx)(PoolDetails,{pool:e,positions:g,refetchPositions:()=>{x.refetch()}})}):(0,l.jsx)("div",{children:"Please connect a wallet."})]})})}eo.displayName=ee.fC.displayName},69057:function(e,t,o){"use strict";o.d(t,{RM:function(){return r},SC:function(){return d},iA:function(){return n},pj:function(){return u},ss:function(){return m},xD:function(){return i}});var s=o(37151),a=o(19605),l=o(91608);let n=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",o),...a})})});n.displayName="Table";let i=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",o),...a})});i.displayName="TableHeader";let r=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",o),...a})});r.displayName="TableBody";let c=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",o),...a})});c.displayName="TableFooter";let d=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",o),...a})});d.displayName="TableRow";let m=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",o),...a})});m.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",o),...a})});u.displayName="TableCell";let p=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,s.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",o),...a})});p.displayName="TableCaption"}},function(e){e.O(0,[495,915,555,867,934,672,582,312,174,67,794,491,446,856,88,295,951,210,744],function(){return e(e.s=94349)}),_N_E=e.O()}]);