(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[998],{54676:function(e,s,t){Promise.resolve().then(t.bind(t,36276))},36276:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return SwapPage}});var a=t(37151),l=t(19605),r=t(47934),n=t(6533),c=t(96111),o=t(64751),i=t(48553),d=t(42799),x=t(10009),m=t(28076),u=t(9678),h=t(67919),p=t(70638),j=t(36921),f=t(5294),g=t(9717);function PreCheckCard(e){let{src:s,amount:t,dst:N,quote:v,setPreChecksPass:w}=e,{toast:S}=(0,d.pm)(),{writeContract:b}=(0,f.S)(),y=(0,r.m)(),k=(0,n.u)({address:s.address,abi:i.j,functionName:"balanceOf",args:[y.address]}),F=(0,n.u)({address:s.address,abi:i.j,functionName:"allowance",args:[y.address,v.routerAddress]}),A=(0,l.useMemo)(()=>{if(!k.isFetched)return"PENDING...";let e=(0,p.v)(t,s.decimals),a=BigInt(k.data?k.data.toString():"0");return a>=e?"PASS":"FAIL"},[k.data,t,s,k.isFetched]),P=(0,l.useMemo)(()=>{if(!F.isFetched)return"PENDING...";let e=(0,p.v)(t,s.decimals),a=BigInt(F.data?F.data.toString():"0");return a>=e?"PASS":"FAIL"},[F.data,t,s,F.isFetched]),[_,I]=(0,l.useState)(!1),[C,E]=(0,l.useState)(t);return(0,l.useEffect)(()=>{let e=!1;"PASS"==P&&"PASS"==A&&(e=!0),w(e)},[P,A,w]),(0,a.jsxs)(o.Zb,{className:"flex:50% w-5/12 min-w-[410px]",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsx)(o.ll,{children:"2. Pre Swap Checks"})}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("form",{children:(0,a.jsx)("div",{className:"flex space-x-5",children:(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsxs)(m._,{htmlFor:"balance",children:["Balance (",s.symbol,")"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:k.data?(0,j.b)(BigInt(k.data.toString()),s.decimals):"0"}),(0,a.jsxs)(m._,{htmlFor:"balanceCheck",children:["Balance checks (balance ",">="," amount)"]}),(0,a.jsx)("p",{className:"PENDING..."==A?"text-sm text-muted-foreground":"FAIL"==A?"text-sm text-red-700":"text-sm text-green-700",children:A})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"routerAddress",children:"Router address"}),(0,a.jsx)(g.default,{address:v.routerAddress,className:"text-sm text-muted-foreground",children:v.routerAddress}),(0,a.jsxs)(m._,{htmlFor:"allowance",children:["Allowance (",s.symbol,")"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:F.data?(0,j.b)(BigInt(F.data.toString()),s.decimals):"0"}),(0,a.jsxs)(m._,{htmlFor:"allowanceCheck",children:["Allowance checks (router allowance ",">="," amount)"]}),(0,a.jsx)("p",{className:"PENDING..."==P?"text-sm text-muted-foreground":"FAIL"==P?"text-sm text-red-700":"text-sm text-green-700",children:P}),(0,a.jsx)(m._,{htmlFor:"allowanceIncrease",children:"Allowance increase"}),(0,a.jsx)(x.I,{type:"number",id:"allowanceAmount",defaultValue:C,onChange:e=>{E(e.target.value)}})]})]})})})}),(0,a.jsx)(o.eW,{children:(0,a.jsx)("div",{className:"columns-1",children:(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)(c.z,{className:(0,c.d)({className:"min-w-60"}),onClick:()=>{I(!0),b({address:s.address,abi:i.j,functionName:"approve",args:[v.routerAddress,(0,p.v)(C,s.decimals)]},{onSuccess:(e,s,t)=>{S({variant:"default",title:"Submitted allowance transaction",description:e})},onError:(e,s,t)=>{I(!1),S({variant:"destructive",title:"ERROR",description:(0,u.X)(e.message)}),console.log("AllowanceError: "+e)},onSettled:(e,s,t,a)=>{I(!1),F.refetch()}})},children:[_?(0,a.jsx)(h.Z,{className:"mr-2 w-4 animate-spin"}):(0,a.jsx)(a.Fragment,{}),_?"Please wait...":"Increase Allowance"]})})})})]})}var N=t(3306),v=t(90409),w=t(44258),S=t(27862),b=t(12787),y=t(91608);let k=S.fC,F=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(S.ck,{ref:s,className:(0,y.cn)("border-b",t),...l})});F.displayName="AccordionItem";let A=l.forwardRef((e,s)=>{let{className:t,children:l,...r}=e;return(0,a.jsx)(S.h4,{className:"flex",children:(0,a.jsxs)(S.xz,{ref:s,className:(0,y.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...r,children:[l,(0,a.jsx)(b.Z,{className:"size-4 shrink-0 transition-transform duration-200"})]})})});A.displayName=S.xz.displayName;let P=l.forwardRef((e,s)=>{let{className:t,children:l,...r}=e;return(0,a.jsx)(S.VY,{ref:s,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:(0,a.jsx)("div",{className:(0,y.cn)("pb-4 pt-0",t),children:l})})});P.displayName=S.VY.displayName;var _=t(26881),I=t(79007),C=t.n(I);let CurrencyAmount=class CurrencyAmount extends _.CurrencyAmount{};function objToCurrencyAmount(e){let s=objToJSBI(e.numerator),t=objToJSBI(e.denominator),a=e.currency;return CurrencyAmount.fromFractionalAmount(a,s,t)}function objToJSBI(e){let s=C().BigInt("0");return Array.isArray(e)&&(s.pop(),s.push(...e)),s}function RouteAccordion(e){let{routes:s}=e,t=[];if(s&&s.length>0){let e=0,l=0;for(let r of s){let s=[];s.push((0,a.jsxs)("span",{children:["\xa0",r.percent.toString().padStart(2," "),"%\xa0:\xa0"]},"routeSpan_"+e++)),s.push((0,a.jsx)("span",{className:"text-sm/3",children:r.tokenPath[0].name},"routeSpan_"+e++));for(let t=1;t<r.tokenPath.length;t++)s.push((0,a.jsx)("span",{children:"\xa0"},"routeSpan_"+e++)),s.push((0,a.jsxs)("span",{className:"relative top-2 inline-block font-serif",children:[(0,a.jsx)("span",{className:"table-row text-center text-[10px]/[5px]",children:r.route.pools[t-1].fee/1e4}),(0,a.jsx)("span",{className:"table-row text-center text-xl/[5px]",children:"âŸ¶"}),(0,a.jsx)("span",{className:"table-row text-center text-[10px]/[5px]",children:"%"})]},"routeSpan_"+e++)),s.push((0,a.jsx)("span",{children:"\xa0"},"routeSpan_"+e++)),s.push((0,a.jsx)("span",{className:"text-sm/3",children:r.tokenPath[t].symbol},"routeSpan_"+e++));s.push((0,a.jsx)("br",{},"routeSpan_"+e++)),objToCurrencyAmount(r.amount),objToCurrencyAmount(r.quote);let n="route_"+l++;t.push((0,a.jsx)("span",{children:s},n))}}return(0,a.jsx)(k,{itemID:"parent",type:"single",collapsible:!0,className:"w-full",children:(0,a.jsxs)(F,{value:"parent-item-1",className:"border-b-0",children:[(0,a.jsx)(A,{children:"Swap route"}),(0,a.jsx)(P,{children:(0,a.jsx)("span",{className:"font-mono text-base",children:t},"spans")})]})})}var E=t(99921);function QuoteCard(e){let{tokens:s,src:t,setSrc:r,amount:n,setAmount:i,dst:f,setDst:g,quote:S,setQuote:b,resetSwap:y}=e,{toast:k}=(0,d.pm)(),[F,A]=(0,l.useState)(n),P=[],_=(0,E.H)();for(let e of s.values())P.push((0,a.jsx)(N.Ql,{value:e.address,children:e.symbol},e.address));let[I,C]=(0,l.useState)(!1),T=[3,3];return(0,a.jsxs)(o.Zb,{className:"flex:50% w-5/12 min-w-[410px]",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsx)(o.ll,{children:"1. Quote"})}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("form",{children:[(0,a.jsxs)("div",{className:"flex space-x-5",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"fromToken",children:"From token"}),(0,a.jsxs)(N.Ph,{onValueChange:e=>{y(),r(s.get(e))},children:[(0,a.jsx)(N.i4,{id:"fromToken",children:(0,a.jsx)(N.ki,{placeholder:t.symbol?t.symbol:"Please select a token"})}),(0,a.jsx)(N.Bw,{position:"popper",children:P})]})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"amount",children:"Amount"}),(0,a.jsx)(x.I,{inputMode:"numeric",required:!0,id:"amount",defaultValue:F,onKeyDown:e=>{var s,t;"Space"==e.code&&e.preventDefault(),T[0]=null!==(s=e.currentTarget.selectionStart)&&void 0!==s?s:0,T[1]=null!==(t=e.currentTarget.selectionEnd)&&void 0!==t?t:0},onChange:e=>{let s=Number(e.currentTarget.value);if(console.log("nVal: "+s),isNaN(s)||s<0||0==e.currentTarget.value.length){e.preventDefault(),e.target.value=F,e.target.selectionStart=T[0],e.target.selectionEnd=T[1];return}y(),A(e.target.value)}})]})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"toToken",children:"To token"}),(0,a.jsxs)(N.Ph,{onValueChange:e=>{y(),g(s.get(e))},children:[(0,a.jsx)(N.i4,{id:"toToken",children:(0,a.jsx)(N.ki,{placeholder:f.symbol?f.symbol:"Please select a token"})}),(0,a.jsx)(N.Bw,{position:"popper",children:P})]})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"quoteAmount",children:"Quote amount"}),(0,a.jsx)(x.I,{readOnly:!0,inputMode:"numeric",id:"quoteAmount",value:S.dstAmount?(0,j.b)(BigInt(S.dstAmount),f.decimals):"0"})]})]})]}),S.gas?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(v.Z,{orientation:"vertical",className:"my-2"}),(0,a.jsx)("div",{className:"flex space-x-5",children:(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"gas",children:"Estimated gas"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:S.gas})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"gasPriceWei",children:"Estimated gas price (gwei)"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,w.d)(BigInt(S.gasPriceWei),"gwei")})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"gasCostEth",children:"Estimated gas cost (eth) [gas*gasPrice]"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,w.d)(BigInt(S.gasPriceWei)*BigInt(S.gas))})]}),(0,a.jsx)(RouteAccordion,{routes:S.sorRoute.route})]})})]}):(0,a.jsx)(a.Fragment,{})]})}),(0,a.jsx)(o.eW,{children:(0,a.jsx)("div",{className:"columns-1",children:(0,a.jsx)("div",{className:"space-y-1",children:(0,a.jsxs)(c.z,{className:(0,c.d)({className:"min-w-60"}),disabled:0==s.size,onClick:()=>{_&&(C(!0),i(F),console.log("Amount: "+n),console.log("fromToken: "+t.symbol),console.log("toToken: "+f.symbol),_.quote({amount:(0,p.v)(F,t.decimals).toString(),slippage:"100",fromToken:t,toToken:f},e=>{console.log(e),b(e),C(!1)},e=>{console.log(e),k({variant:"destructive",title:"ERROR",description:(0,u.X)(e.toString())}),C(!1)}))},children:[I?(0,a.jsx)(h.Z,{className:"mr-2 w-4 animate-spin"}):(0,a.jsx)(a.Fragment,{}),I?"Please wait...":"Quote"]})})})})]})}var T=t(54701);function SwapCard(e){let{src:s,amount:t,dst:n,setSwapTx:i}=e,{toast:x}=(0,d.pm)(),{sendTransaction:f}=(0,T.p)(),N=(0,r.m)(),[S,b]=(0,l.useState)({}),y=(0,E.H)(),[k,F]=(0,l.useState)(!1),[A,P]=(0,l.useState)(!1),[_,I]=(0,l.useState)("PENDING...");return(0,a.jsxs)(o.Zb,{className:"flex:50% w-5/12 min-w-[410px]",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsx)(o.ll,{children:"3. Simulate & Execute Swap"})}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("form",{children:[(0,a.jsx)("div",{className:"space-x-5",children:(0,a.jsx)("div",{className:"flex-1 space-y-2",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"balance",children:"Simulated swap"}),(0,a.jsx)("p",{className:"PENDING..."==_?"text-sm text-muted-foreground":"FAIL"==_?"text-sm text-red-700":"text-sm text-green-700",children:_})]})})}),S.tx?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(v.Z,{orientation:"vertical",className:"my-2"}),(0,a.jsx)("div",{className:"flex space-x-5",children:(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"routerAddress",children:"Router address"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,a.jsx)(g.default,{address:S.tx.to,children:S.tx.to})}),(0,a.jsxs)(m._,{htmlFor:"swapAmount",children:["Swap amount (",n.symbol,")"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,j.b)(BigInt(S.dstAmount),n.decimals)}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"gas",children:"Simulated gas"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:S.tx.gas})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"gasPriceWei",children:"Simulated gas price (gwei)"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,w.d)(BigInt(S.tx.gasPrice),"gwei")})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"gasCostEth",children:"Simulated gas cost (eth) [gas*gasPrice]"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,w.d)(BigInt(S.tx.gasPrice)*BigInt(S.tx.gas))})]})]})})]}):(0,a.jsx)(a.Fragment,{})]})}),(0,a.jsx)(o.eW,{children:(0,a.jsx)("div",{className:"columns-1",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(c.z,{className:(0,c.d)({className:"min-w-60"}),onClick:()=>{F(!0),b({}),y.swap({amount:(0,p.v)(t,s.decimals).toString(),slippage:"100",fromToken:s,toToken:n,from:N.address},e=>{console.log(e),b(e),F(!1),I("PASS")},e=>{console.log(e),x({variant:"destructive",title:"ERROR",description:(0,u.X)(e.toString())}),F(!1)})},children:[k?(0,a.jsx)(h.Z,{className:"mr-2 w-4 animate-spin"}):(0,a.jsx)(a.Fragment,{}),k?"Please wait...":"Simulate Swap"]}),(0,a.jsx)(v.Z,{orientation:"horizontal",className:"my-4"}),(0,a.jsxs)(c.z,{className:(0,c.d)({className:"min-w-60"}),disabled:void 0===S.dstAmount,onClick:()=>{P(!0),f({to:S.tx.to,data:S.tx.data,gas:BigInt(S.tx.gas),account:N.address,value:(0,p.v)(BigInt(S.tx.value).toString(),18)},{onSuccess:(e,s,t)=>{x({variant:"default",title:"Submitted swap transaction",description:e}),i(e)},onError:(e,s,t)=>{P(!1),x({variant:"destructive",title:"ERROR",description:(0,u.X)(e.message)}),console.log("SwapError: "+e)},onSettled:(e,s,t,a)=>{P(!1)}})},children:[A?(0,a.jsx)(h.Z,{className:"mr-2 w-4 animate-spin"}):(0,a.jsx)(a.Fragment,{}),A?"Please wait...":"Execute Swap"]})]})})})]})}var B=t(10649),R=t(57867),Z=t.n(R);function BlockLink(e){let{children:s,blockNumber:t,className:l}=e,n=(0,r.m)(),c=n.chainId;return(0,a.jsx)(Z(),{href:B._.blockChainExplorerPrefix(c)+t,target:"_blank",prefetch:!1,className:l,children:s})}var D=t(16303),O=t(26217);function SwapResultCard(e){let{swapTx:s}=e,t=(0,O.A)({hash:s,pollingInterval:1e3});return(0,a.jsxs)(o.Zb,{className:"flex:50% w-5/12 min-w-[410px]",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsx)(o.ll,{children:"4. Swap Transaction"})}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("form",{children:(0,a.jsx)("div",{className:"space-x-5",children:(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"swapTx",children:"Swap transaction"}),(0,a.jsx)("p",{className:"max-w-[370px] text-wrap break-words text-sm text-muted-foreground",children:(0,a.jsx)(D.Z,{hash:s,children:s})})]}),t.isFetched?(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"txStatus",children:"Status"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t.status}),t.data?(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"blockNumber",children:"Block number"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,a.jsx)(BlockLink,{blockNumber:t.data.blockNumber.toString(),children:t.data.blockNumber.toString()})}),(0,a.jsx)(m._,{htmlFor:"gas",children:"Gas used"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t.data.gasUsed.toString()}),(0,a.jsx)(m._,{htmlFor:"gasPrice",children:"Effective gas price (gwei)"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,w.d)(t.data.effectiveGasPrice,"gwei")}),(0,a.jsx)(m._,{htmlFor:"gasCost",children:"Gas cost(eth)"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,w.d)(t.data.effectiveGasPrice*t.data.gasUsed)})]}):(0,a.jsx)(a.Fragment,{})]}):(0,a.jsx)(a.Fragment,{})]})})})}),(0,a.jsx)(o.eW,{})]})}var z=t(87707);function SwapPage(){let[e,s]=(0,l.useState)({}),[t,c]=(0,l.useState)({}),[o,i]=(0,l.useState)({}),[d,x]=(0,l.useState)("100"),[m,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),j=(0,r.m)(),f=(0,n.u)({...z.L,functionName:"getAllManagedTokens",args:[]}),g=(0,l.useMemo)(()=>{let e=new Map;if(f.isFetched&&f.data)for(let s of f.data)e.set(s.tokenAddress,{address:s.tokenAddress,decimals:s.decimals,symbol:s.symbol,eip2612:!1,isFoT:!1,logoURI:"",name:s.name});if(console.log(e),e.size>3){let s=e.values();s.next(),c(s.next().value),i(s.next().value)}return e},[f.data,f.isFetched]);return(0,a.jsx)("section",{className:"container grid items-center gap-6 pb-8 pt-6 md:py-10",children:(0,a.jsxs)("div",{className:"flex max-w-[980px] flex-wrap items-start gap-2",children:[(0,a.jsx)("p",{className:"max-w-[900px] text-lg text-muted-foreground",children:"Explore the 'anatomy' of a swap and its various stages. Note that if multiple swaps happen concurrently the quoted amount and the actual swap amount may differ (within the specified slippage limit - currently hardcoded to 1%)."}),(0,a.jsxs)("p",{className:"max-w-[900px] text-lg text-muted-foreground",children:["For a better understanding of the uniswap protocol please read the ",(0,a.jsx)("a",{href:"https://docs.uniswap.org/concepts/uniswap-protocol",target:"_blank",children:"docs"}),"."]}),(0,a.jsx)(QuoteCard,{tokens:g,src:t,setSrc:c,amount:d,setAmount:x,dst:o,setDst:i,quote:e,setQuote:s,resetSwap:function(){p(""),s({}),u(!1),console.log("resetDone")}}),j.isConnected?(0,a.jsxs)(a.Fragment,{children:[e.dstAmount?(0,a.jsx)(PreCheckCard,{src:t,amount:d,dst:o,quote:e,setPreChecksPass:u}):(0,a.jsx)(a.Fragment,{}),m?(0,a.jsx)(SwapCard,{src:t,amount:d,dst:o,setSwapTx:p}):(0,a.jsx)(a.Fragment,{}),""!=h?(0,a.jsx)(SwapResultCard,{swapTx:h}):(0,a.jsx)(a.Fragment,{})]}):(0,a.jsx)("div",{children:(0,a.jsx)("p",{children:"Please connect a wallet."})})]})})}}},function(e){e.O(0,[495,915,555,867,934,672,582,312,174,67,794,491,446,586,88,295,951,210,744],function(){return e(e.s=54676)}),_N_E=e.O()}]);